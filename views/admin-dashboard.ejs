<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ExHub — Admin Dashboard</title>
  <link rel="icon" type="image/png" href="/img/ExLogo2.png" />
  <link rel="stylesheet" href="/css/main.css" />
</head>
<body class="page-dark">

<header class="site-header">
  <div class="container header-inner">
    <div class="logo">
      <span class="logo-icon">
        <img src="/img/ExLogo2.png" alt="ExHub" class="logo-img" />
      </span>
      <span class="logo-text" id="logo-text">ExHub — Admin Dashboard</span>
    </div>
    <form method="post" action="/admin/logout" class="header-action">
      <button class="btn-ghost btn-small" type="submit">Logout</button>
    </form>
  </div>
</header>

<main class="section">
  <div class="container admin-dashboard">

    <!-- HEADER + FILTER -->
    <section class="dashboard-header">
      <div class="dashboard-header-main">
        <h1 class="section-title small">Dashboard</h1>
        <p class="section-subtitle">
          Monitor semua eksekusi script ExHub: users, HWID, executor, key, dan performa script.
        </p>
      </div>

      <form method="get" action="/admin" class="dashboard-filter">
        <label>
          Periode
          <select name="period">
            <option value="24h" <%= stats.period === '24h' ? 'selected' : '' %>>24 jam</option>
            <option value="7d"  <%= stats.period === '7d'  ? 'selected' : '' %>>7 hari</option>
            <option value="30d" <%= stats.period === '30d' ? 'selected' : '' %>>30 hari</option>
            <option value="all" <%= (!stats.period || stats.period === 'all') ? 'selected' : '' %>>Semua</option>
          </select>
        </label>
        <button class="btn-ghost btn-small" type="submit">Apply</button>
      </form>
    </section>

    <!-- TOP OVERVIEW STATS -->
    <section class="dashboard-overview card-grid">
      <article class="stat-card">
        <div class="stat-card-label">Supported Games</div>
        <div class="stat-card-value"><%= stats.totalGames || 0 %></div>
        <div class="stat-card-meta">Total game yang di-link ke ExHub</div>
      </article>

      <article class="stat-card">
        <div class="stat-card-label">Scripts</div>
        <div class="stat-card-value"><%= stats.totalScripts || scripts.length || 0 %></div>
        <div class="stat-card-meta">Jumlah script terdaftar</div>
      </article>

      <article class="stat-card">
        <div class="stat-card-label">Total Executions</div>
        <div class="stat-card-value"><%= stats.totalExecutions || 0 %></div>
        <div class="stat-card-meta">Semua waktu</div>
      </article>

      <article class="stat-card">
        <div class="stat-card-label">Executions (24h)</div>
        <div class="stat-card-value"><%= stats.executions24h || 0 %></div>
        <div class="stat-card-meta">Aktivitas 24 jam terakhir</div>
      </article>

      <article class="stat-card">
        <div class="stat-card-label">Users</div>
        <div class="stat-card-value"><%= stats.totalUsers || 0 %></div>
        <div class="stat-card-meta">User unik (userId)</div>
      </article>

      <article class="stat-card">
        <div class="stat-card-label">Active Users (24h)</div>
        <div class="stat-card-value"><%= stats.activeUsers24h || 0 %></div>
        <div class="stat-card-meta">User eksekusi hari ini</div>
      </article>

      <article class="stat-card">
        <div class="stat-card-label">Unique HWID</div>
        <div class="stat-card-value"><%= stats.uniqueHwids || 0 %></div>
        <div class="stat-card-meta">Device unik terdeteksi</div>
      </article>

      <article class="stat-card">
        <div class="stat-card-label">Avg Exec / User</div>
        <div class="stat-card-value"><%= stats.avgExecPerUser || 0 %></div>
        <div class="stat-card-meta">Rata-rata lifetime</div>
      </article>

      <article class="stat-card">
        <div class="stat-card-label">Avg Exec / HWID</div>
        <div class="stat-card-value"><%= stats.avgExecPerHwid || 0 %></div>
        <div class="stat-card-meta">Rata-rata lifetime</div>
      </article>
    </section>

    <!-- QUICK SEARCH AREA -->
    <section class="card admin-search">
      <header class="card-header">
        <h2 class="admin-subtitle">Quick Search</h2>
        <p class="card-description">
          Cari user, HWID, atau key tertentu untuk investigasi cepat.
        </p>
      </header>

      <div class="search-row">
        <form method="get" action="/admin/search/user" class="search-form">
          <label>
            Username / UserId
            <input type="text" name="q" placeholder="misal: 12345678 atau ExPlayer" />
          </label>
          <button class="btn-outline btn-small" type="submit">Search User</button>
        </form>

        <form method="get" action="/admin/search/hwid" class="search-form">
          <label>
            HWID
            <input type="text" name="q" placeholder="awal HWID / full HWID" />
          </label>
          <button class="btn-outline btn-small" type="submit">Search HWID</button>
        </form>

        <form method="get" action="/admin/key-check" class="search-form">
          <label>
            Key / Username
            <input type="text" name="q" placeholder="token key / username / userId" />
          </label>
          <button class="btn-outline btn-small" type="submit">Key Check</button>
        </form>
      </div>
    </section>

    <!-- KEY CHECKER CARD -->
    <section class="card admin-keycheck">
      <header class="card-header">
        <div>
          <h2 class="admin-subtitle">Key Checker (Work.ink / Username)</h2>
          <p class="card-description">
            Cek apakah sebuah key atau player (username / userId) pernah menggunakan ExHub Loader.
          </p>
        </div>
      </header>

      <form method="get" action="/admin/key-check" class="admin-form keycheck-form">
        <div class="row-cols">
          <label>
            Key / Username / UserId
            <input type="text"
                   name="q"
                   value="<%= (keyCheck && keyCheck.query) ? keyCheck.query : '' %>"
                   placeholder="contoh: EXHUB-ABC-123-XYZ atau SomeUser atau 123456789" />
          </label>
          <label>
            Periode
            <select name="period">
              <option value="all" <%= (!keyCheck || keyCheck.period === 'all') ? 'selected' : '' %>>Semua</option>
              <option value="24h" <%= keyCheck && keyCheck.period === '24h' ? 'selected' : '' %>>24 jam</option>
              <option value="7d"  <%= keyCheck && keyCheck.period === '7d'  ? 'selected' : '' %>>7 hari</option>
              <option value="30d" <%= keyCheck && keyCheck.period === '30d' ? 'selected' : '' %>>30 hari</option>
            </select>
          </label>
        </div>
        <button class="btn-primary btn-small" type="submit">Run Key Check</button>
      </form>

      <div class="table-wrapper" style="margin-top: 14px;">
        <% if (keyCheck && keyCheck.query && keyCheck.total > 0) { %>
          <p class="card-description">
            Hasil untuk query:
            <strong><%= keyCheck.query %></strong>
            — ditemukan <strong><%= keyCheck.total %></strong> kombinasi player/script.
          </p>

          <% var keyMatches = keyCheck.matches || []; %>
          <table class="table table-compact">
            <thead>
              <tr>
                <th>Script</th>
                <th>User</th>
                <th>UserId</th>
                <th>HWID</th>
                <th>Key</th>
                <th>Exec</th>
                <th>Last Exec</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% keyMatches.forEach(function(item) { %>
                <tr>
                  <td>
                    <div class="table-main-text"><%= item.scriptName || item.scriptId || '-' %></div>
                    <div class="table-sub-text"><%= item.scriptId || '' %></div>
                  </td>
                  <td>
                    <div class="table-main-text">
                      <%= item.displayName || item.username || '-' %>
                    </div>
                    <div class="table-sub-text">
                      @<%= item.username || '-' %>
                    </div>
                  </td>
                  <td>
                    <div class="table-main-text">
                      <%= item.userId || '-' %>
                    </div>
                    <% if (item.userId) { %>
                      <button type="button"
                              class="chip chip-copy"
                              data-copy="<%= item.userId %>">
                        copy
                      </button>
                    <% } %>
                  </td>
                  <td>
                    <div class="table-main-text hwid-cell">
                      <% if (item.hwid) { %>
                        <span class="mono">
                          <%= item.hwid.length > 12
                                ? (item.hwid.substring(0,6) + '…' + item.hwid.slice(-4))
                                : item.hwid %>
                        </span>
                      <% } else { %>
                        -
                      <% } %>
                    </div>
                    <% if (item.hwid) { %>
                      <button type="button"
                              class="chip chip-copy"
                              data-copy="<%= item.hwid %>">
                        copy
                      </button>
                    <% } %>
                  </td>
                  <td>
                    <% if (item.keyToken) { %>
                      <div class="table-main-text mono">
                        <%= item.keyToken.length > 12
                              ? (item.keyToken.substring(0,4) + '…' + item.keyToken.slice(-4))
                              : item.keyToken %>
                      </div>
                      <button type="button"
                              class="chip chip-copy"
                              data-copy="<%= item.keyToken %>">
                        copy
                      </button>
                      <div class="table-sub-text">
                        <% if (item.keyCreatedAt) { %>
                          Created: <%= item.keyCreatedAt %>
                        <% } %>
                        <% if (item.keyExpiresAt) { %>
                          · Expires: <%= item.keyExpiresAt %>
                        <% } %>
                      </div>
                    <% } else { %>
                      -
                    <% } %>
                  </td>
                  <td>
                    <div class="table-main-text">
                      <%= item.totalExecutes || 0 %>
                    </div>
                  </td>
                  <td>
                    <div class="table-main-text">
                      <%= item.lastExecuteAt || '-' %>
                    </div>
                  </td>
                  <td>
                    <% if (item.key) { %>
                      <!-- item.key dari buildAdminStats (composite scriptId:userId:hwid) -->
                    <% } %>
                    <form method="post"
                          action="/admin/exec-users/delete"
                          onsubmit="return confirm('Yakin hapus data tracking player ini?');">
                      <input type="hidden" name="entryKey" value="<%= item.key %>" />
                      <button type="submit" class="btn-ghost btn-small">
                        Delete
                      </button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } else if (keyCheck && keyCheck.query && keyCheck.total === 0) { %>
          <p class="empty-state small">
            Tidak ditemukan player yang cocok untuk "<strong><%= keyCheck.query %></strong>".
          </p>
        <% } else { %>
          <p class="empty-state small">
            Masukkan key atau username untuk melakukan pengecekan.
          </p>
        <% } %>
      </div>
    </section>

    <!-- MAIN LAYOUT: LEFT = ACTIVITY, RIGHT = TOP LISTS -->
    <div class="dashboard-main">

      <!-- LEFT: LATEST EXECUTIONS -->
      <section class="card card-main">
        <header class="card-header">
          <div class="card-header-main">
            <h2 class="admin-subtitle">Latest Executions</h2>
            <p class="card-description">
              Riwayat eksekusi terakhir termasuk script, user, HWID, executor, key, dan informasi server.
            </p>
          </div>
          <span class="card-badge">
            Menampilkan
            <strong><%= (stats.recentExecutions && stats.recentExecutions.length) || 0 %></strong>
            eksekusi terbaru
          </span>
        </header>

        <div class="table-wrapper">
          <% if (stats.recentExecutions && stats.recentExecutions.length) { %>
            <table class="table table-compact">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Script</th>
                  <th>User</th>
                  <th>UserId</th>
                  <th>HWID</th>
                  <th>Executor</th>
                  <th>Key</th>
                  <th>Exec #</th>
                  <th>Game / Place</th>
                  <th>Server</th>
                </tr>
              </thead>
              <tbody>
                <% stats.recentExecutions.forEach(function(exec) { %>
                  <tr>
                    <td>
                      <div class="table-main-text">
                        <%= exec.timeAgo || exec.executedAtHuman || '-' %>
                      </div>
                      <div class="table-sub-text">
                        <%= exec.executedAtIso || exec.executedAt || '' %>
                      </div>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= exec.scriptName || exec.scriptId || '-' %>
                      </div>
                      <div class="table-sub-text"><%= exec.scriptId || '' %></div>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= exec.displayName || exec.username || '-' %>
                      </div>
                      <div class="table-sub-text">
                        @<%= exec.username || '-' %>
                      </div>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= exec.userId || '-' %>
                      </div>
                      <% if (exec.userId) { %>
                        <button type="button"
                                class="chip chip-copy"
                                data-copy="<%= exec.userId %>">
                          copy
                        </button>
                      <% } %>
                    </td>
                    <td>
                      <div class="table-main-text hwid-cell">
                        <% if (exec.hwid) { %>
                          <span class="mono">
                            <%= exec.hwid.length > 12
                                  ? (exec.hwid.substring(0,6) + '…' + exec.hwid.slice(-4))
                                  : exec.hwid %>
                          </span>
                        <% } else { %>
                          -
                        <% } %>
                      </div>
                      <% if (exec.hwid) { %>
                        <button type="button"
                                class="chip chip-copy"
                                data-copy="<%= exec.hwid %>">
                          copy
                        </button>
                      <% } %>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= exec.executorUse || exec.executor || '-' %>
                      </div>
                    </td>
                    <td>
                      <% if (exec.key) { %>
                        <div class="table-main-text mono">
                          <%= exec.key.length > 12
                                ? (exec.key.substring(0,4) + '…' + exec.key.slice(-4))
                                : exec.key %>
                        </div>
                        <button type="button"
                                class="chip chip-copy"
                                data-copy="<%= exec.key %>">
                          copy
                        </button>
                      <% } else { %>
                        -
                      <% } %>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= exec.executeCount || exec.execIndex || 1 %>
                      </div>
                      <div class="table-sub-text">device counter</div>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= exec.mapName || '-' %>
                      </div>
                      <div class="table-sub-text">
                        PlaceId: <%= exec.placeId || '-' %>
                      </div>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= exec.serverId && exec.serverId.length > 10
                              ? exec.serverId.substring(0,10) + '…'
                              : (exec.serverId || '-') %>
                      </div>
                      <% if (exec.serverId) { %>
                        <button type="button"
                                class="chip chip-copy"
                                data-copy="<%= exec.serverId %>">
                          copy
                        </button>
                      <% } %>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          <% } else { %>
            <p class="empty-state">
              Belum ada data eksekusi terbaru untuk periode ini.
            </p>
          <% } %>
        </div>
      </section>

      <!-- RIGHT: TOP LISTS -->
      <aside class="dashboard-side">

        <!-- TOP SCRIPTS -->
        <section class="card">
          <header class="card-header">
            <h3 class="admin-subtitle">Top Scripts</h3>
            <p class="card-description">Script dengan eksekusi terbanyak.</p>
          </header>

          <% if (stats.topScripts && stats.topScripts.length) { %>
            <ul class="list-ranking">
              <% stats.topScripts.forEach(function(item, idx) { %>
                <li class="list-ranking-item">
                  <span class="rank"><%= idx + 1 %></span>
                  <div class="rank-main">
                    <div class="rank-title">
                      <%= item.name || item.scriptName || item.id %>
                    </div>
                    <div class="rank-sub">
                      <span class="badge-soft">ID: <%= item.id %></span>
                      <% if (item.gameName) { %>
                        <span class="badge-soft">Game: <%= item.gameName %></span>
                      <% } %>
                    </div>
                  </div>
                  <div class="rank-metric">
                    <span class="rank-value"><%= item.executions || item.uses || 0 %></span>
                    <span class="rank-label">exec</span>
                  </div>
                </li>
              <% }) %>
            </ul>
          <% } else { %>
            <p class="empty-state small">Belum ada ranking script.</p>
          <% } %>
        </section>

        <!-- TOP USERS -->
        <section class="card">
          <header class="card-header">
            <h3 class="admin-subtitle">Top Users</h3>
            <p class="card-description">User dengan jumlah eksekusi terbanyak.</p>
          </header>

          <% if (stats.topUsers && stats.topUsers.length) { %>
            <ul class="list-ranking">
              <% stats.topUsers.forEach(function(item, idx) { %>
                <li class="list-ranking-item">
                  <span class="rank"><%= idx + 1 %></span>
                  <div class="rank-main">
                    <div class="rank-title">
                      <%= item.displayName || item.username || '-' %>
                    </div>
                    <div class="rank-sub">
                      @<%= item.username || '-' %> · ID: <%= item.userId || '-' %>
                    </div>
                  </div>
                  <div class="rank-metric">
                    <span class="rank-value"><%= item.executions || 0 %></span>
                    <span class="rank-label">exec</span>
                  </div>
                </li>
              <% }) %>
            </ul>
          <% } else { %>
            <p class="empty-state small">Belum ada ranking user.</p>
          <% } %>
        </section>

        <!-- TOP HWID -->
        <section class="card">
          <header class="card-header">
            <h3 class="admin-subtitle">Top HWID</h3>
            <p class="card-description">Device yang paling sering menjalankan ExHub.</p>
          </header>

          <% if (stats.topHwids && stats.topHwids.length) { %>
            <ul class="list-ranking">
              <% stats.topHwids.forEach(function(item, idx) { %>
                <li class="list-ranking-item">
                  <span class="rank"><%= idx + 1 %></span>
                  <div class="rank-main">
                    <div class="rank-title mono">
                      <% if (item.hwid) { %>
                        <%= item.hwid.length > 16
                              ? (item.hwid.substring(0,10) + '…' + item.hwid.slice(-4))
                              : item.hwid %>
                      <% } else { %>
                        -
                      <% } %>
                    </div>
                    <div class="rank-sub">
                      <%= item.lastUsername ? ('Last: @' + item.lastUsername) : '' %>
                    </div>
                  </div>
                  <div class="rank-metric">
                    <span class="rank-value"><%= item.executions || 0 %></span>
                    <span class="rank-label">exec</span>
                  </div>
                </li>
              <% }) %>
            </ul>
          <% } else { %>
            <p class="empty-state small">Belum ada ranking HWID.</p>
          <% } %>
        </section>

      </aside>
    </div>

    <!-- LOADER USERS LIST (ALL PLAYERS) -->
    <section class="admin-section">
      <div class="card">
        <header class="card-header">
          <div>
            <h2 class="admin-subtitle">Loader Users (All Players)</h2>
            <p class="card-description">
              Daftar semua kombinasi script/player/HWID yang pernah melaporkan eksekusi ke /api/exec.
            </p>
          </div>
          <span class="card-badge">
            Total rows:
            <strong><%= (stats.loaderUsers && stats.loaderUsers.length) || 0 %></strong>
          </span>
        </header>

        <div class="table-wrapper">
          <% if (stats.loaderUsers && stats.loaderUsers.length) { %>
            <% var loaderList = stats.loaderUsers.slice(0, 300); %>
            <table class="table table-compact">
              <thead>
                <tr>
                  <th>Script</th>
                  <th>User</th>
                  <th>UserId</th>
                  <th>HWID</th>
                  <th>Exec</th>
                  <th>Key</th>
                  <th>Last Exec</th>
                  <th>IP</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% loaderList.forEach(function(item) { %>
                  <tr>
                    <td>
                      <div class="table-main-text"><%= item.scriptName || item.scriptId || '-' %></div>
                      <div class="table-sub-text"><%= item.scriptId || '' %></div>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= item.displayName || item.username || '-' %>
                      </div>
                      <div class="table-sub-text">
                        @<%= item.username || '-' %>
                      </div>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= item.userId || '-' %>
                      </div>
                      <% if (item.userId) { %>
                        <button type="button"
                                class="chip chip-copy"
                                data-copy="<%= item.userId %>">
                          copy
                        </button>
                      <% } %>
                    </td>
                    <td>
                      <div class="table-main-text hwid-cell">
                        <% if (item.hwid) { %>
                          <span class="mono">
                            <%= item.hwid.length > 12
                                  ? (item.hwid.substring(0,6) + '…' + item.hwid.slice(-4))
                                  : item.hwid %>
                          </span>
                        <% } else { %>
                          -
                        <% } %>
                      </div>
                      <% if (item.hwid) { %>
                        <button type="button"
                                class="chip chip-copy"
                                data-copy="<%= item.hwid %>">
                          copy
                        </button>
                      <% } %>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= item.totalExecutes || 0 %>
                      </div>
                    </td>
                    <td>
                      <% if (item.keyToken) { %>
                        <div class="table-main-text mono">
                          <%= item.keyToken.length > 12
                                ? (item.keyToken.substring(0,4) + '…' + item.keyToken.slice(-4))
                                : item.keyToken %>
                        </div>
                        <button type="button"
                                class="chip chip-copy"
                                data-copy="<%= item.keyToken %>">
                          copy
                        </button>
                      <% } else { %>
                        -
                      <% } %>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= item.lastExecuteAt || '-' %>
                      </div>
                    </td>
                    <td>
                      <div class="table-main-text">
                        <%= item.lastIp || '-' %>
                      </div>
                    </td>
                    <td>
                      <form method="post"
                            action="/admin/exec-users/delete"
                            onsubmit="return confirm('Yakin hapus data tracking player ini?');">
                        <input type="hidden" name="entryKey" value="<%= item.key %>" />
                        <button type="submit" class="btn-ghost btn-small">
                          Delete
                        </button>
                      </form>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
            <% if (stats.loaderUsers.length > 300) { %>
              <p class="card-description small">
                Ditampilkan 300 row pertama dari <%= stats.loaderUsers.length %> total data.
              </p>
            <% } %>
          <% } else { %>
            <p class="empty-state small">
              Belum ada data dari /api/exec.
            </p>
          <% } %>
        </div>
      </div>
    </section>

    <!-- SCRIPT MANAGEMENT -->
    <section class="admin-section">
      <div class="card">
        <header class="card-header">
          <div>
            <h2 class="admin-subtitle">Scripts</h2>
            <p class="card-description">
              Konfigurasi metadata setiap script (nama, game, versi, status, free/premium, thumbnail, dan file).
            </p>
          </div>
        </header>

        <div class="admin-table">
          <% scripts.forEach(function(script) { %>
            <form method="post"
                  action="/admin/scripts/<%= script.id %>"
                  enctype="multipart/form-data"
                  class="admin-script-row">
              <div class="row-main">
                <div class="row-title">
                  <strong><%= script.id %></strong>
                  <% if (script.gameName) { %>
                    <span class="row-subtitle"><%= script.gameName %></span>
                  <% } %>
                </div>

                <div class="row-cols">
                  <label>
                    Name
                    <input type="text" name="name" value="<%= script.name %>" />
                  </label>
                  <label>
                    Game Name
                    <input type="text" name="gameName" value="<%= script.gameName %>" />
                  </label>
                  <label>
                    Version
                    <input type="text" name="version" value="<%= script.version %>" />
                  </label>
                  <label>
                    Status
                    <select name="status">
                      <option value="working" <%= script.status === 'working' ? 'selected' : '' %>>working</option>
                      <option value="testing" <%= script.status === 'testing' ? 'selected' : '' %>>testing</option>
                      <option value="down"    <%= script.status === 'down'    ? 'selected' : '' %>>down</option>
                    </select>
                  </label>
                  <label class="checkbox-inline">
                    <input type="checkbox" name="isFree" <%= script.isFree ? 'checked' : '' %> /> Free
                  </label>
                  <label>
                    Uses
                    <input type="number" name="uses" value="<%= script.uses || 0 %>" />
                  </label>
                  <label>
                    Users
                    <input type="number" name="users" value="<%= script.users || 0 %>" />
                  </label>
                  <label>
                    Thumbnail URL
                    <input type="text" name="thumbnail" value="<%= script.thumbnail || '' %>" />
                  </label>
                  <label>
                    Script File
                    <input type="text" name="scriptFile" value="<%= script.scriptFile %>" />
                  </label>

                  <!-- Upload / paste body script (publish ke API loader) -->
                  <label>
                    Upload Script (.lua / .txt)
                    <input type="file" name="scriptUpload" accept=".lua,.txt" />
                  </label>
                  <label>
                    Script Body (opsional)
                    <textarea name="scriptBody"
                              rows="4"
                              placeholder="Paste Lua script di sini (jika diisi, akan diprioritaskan daripada file upload)"></textarea>
                  </label>
                </div>
              </div>
              <div class="row-actions">
                <button class="btn-primary btn-small" type="submit">Save</button>
              </div>
            </form>
          <% }) %>
        </div>
      </div>
    </section>

    <!-- PRIVATE RAW FILES (HANYA ADMIN, TIDAK DIPUBLISH KE WEB/API) -->
    <section class="admin-section">
      <div class="card">
        <header class="card-header">
          <div>
            <h2 class="admin-subtitle">Private Raw Files</h2>
            <p class="card-description">
              File Lua/txt pribadi yang tidak dipublish ke website atau endpoint API.
              Hanya terlihat di panel admin (bisa upload, edit, dan delete).
            </p>
          </div>
        </header>

        <% var rawFilesSafe = (typeof rawFiles !== 'undefined' && rawFiles) ? rawFiles : []; %>

        <div class="admin-table">
          <% if (rawFilesSafe.length) { %>
            <% rawFilesSafe.forEach(function(file) { %>
              <form method="post"
                    action="/admin/raw-files/<%= file.id %>"
                    enctype="multipart/form-data"
                    class="admin-script-row">
                <div class="row-main">
                  <div class="row-title">
                    <strong><%= file.id %></strong>
                    <% if (file.name) { %>
                      <span class="row-subtitle"><%= file.name %></span>
                    <% } %>
                  </div>
                  <div class="row-subtitle small">
                    Last update: <%= file.updatedAt || '-' %>
                  </div>

                  <div class="row-cols">
                    <label>
                      Name / Label
                      <input type="text" name="name" value="<%= file.name || '' %>" />
                    </label>
                    <label>
                      Note (internal)
                      <input type="text" name="note" value="<%= file.note || '' %>" />
                    </label>
                    <label>
                      Upload (.lua / .txt)
                      <input type="file" name="rawUpload" accept=".lua,.txt" />
                    </label>
                    <label>
                      File Body
                      <textarea name="body"
                                rows="5"
                                placeholder="Isi file (jika diisi, akan menimpa isi lama)"><%= file.preview || '' %></textarea>
                    </label>
                  </div>
                </div>
                <div class="row-actions">
                  <button class="btn-primary btn-small" type="submit">Save</button>
                  <form method="post"
                        action="/admin/raw-files/<%= file.id %>/delete"
                        onsubmit="return confirm('Yakin hapus private file ini?');"
                        class="inline-delete-form">
                    <button class="btn-ghost btn-small" type="submit">Delete</button>
                  </form>
                </div>
              </form>
            <% }) %>
          <% } else { %>
            <p class="empty-state small" style="padding: 12px 0 4px;">
              Belum ada private raw file yang tersimpan.
            </p>
          <% } %>
        </div>
      </div>
    </section>

    <!-- ADD NEW PRIVATE RAW FILE -->
    <section class="admin-section">
      <div class="card">
        <header class="card-header">
          <div>
            <h2 class="admin-subtitle">Add private raw file</h2>
            <p class="card-description">
              Simpan file Lua/txt pribadi yang hanya bisa dilihat di panel admin.
            </p>
          </div>
        </header>

        <form method="post"
              action="/admin/raw-files"
              enctype="multipart/form-data"
              class="admin-form add-form">
          <div class="row-cols">
            <label>
              ID (slug unik)
              <input type="text" name="id" placeholder="indo-ocean-dev-raw" required />
            </label>
            <label>
              Name / Label
              <input type="text" name="name" placeholder="Indo Ocean Dev Tab" />
            </label>
            <label>
              Note (internal)
              <input type="text" name="note" placeholder="catatan singkat / versi / tujuan" />
            </label>
            <label>
              Upload (.lua / .txt)
              <input type="file" name="rawUpload" accept=".lua,.txt" />
            </label>
            <label>
              File Body (opsional)
              <textarea name="body"
                        rows="5"
                        placeholder="Paste isi Lua/txt di sini (jika diisi, akan diprioritaskan daripada file upload)"></textarea>
            </label>
          </div>
          <button class="btn-outline full" type="submit">Save Private File</button>
        </form>
      </div>
    </section>

    <!-- ADD NEW SCRIPT (PUBLISHED VIA LOADER API) -->
    <section class="admin-section">
      <div class="card">
        <header class="card-header">
          <div>
            <h2 class="admin-subtitle">Add new script</h2>
            <p class="card-description">
              Daftarkan script baru ke ExHub dan hubungkan dengan file Lua Anda.
            </p>
          </div>
        </header>

        <form method="post"
              action="/admin/scripts"
              enctype="multipart/form-data"
              class="admin-form add-form">
          <div class="row-cols">
            <label>
              ID (slug)
              <input type="text" name="id" placeholder="indo-ocean" required />
            </label>
            <label>
              Name
              <input type="text" name="name" />
            </label>
            <label>
              Game Name
              <input type="text" name="gameName" />
            </label>
            <label>
              Version
              <input type="text" name="version" value="v1.0.0" />
            </label>
            <label>
              Status
              <select name="status">
                <option value="working">working</option>
                <option value="testing">testing</option>
                <option value="down">down</option>
              </select>
            </label>
            <label class="checkbox-inline">
              <input type="checkbox" name="isFree" checked /> Free
            </label>
            <label>
              Uses
              <input type="number" name="uses" value="0" />
            </label>
            <label>
              Users
              <input type="number" name="users" value="0" />
            </label>
            <label>
              Thumbnail URL
              <input type="text" name="thumbnail" />
            </label>
            <label>
              Script File
              <input type="text" name="scriptFile" placeholder="spear_fishing.lua" />
            </label>
            <label>
              Upload Script (.lua / .txt)
              <input type="file" name="scriptUpload" accept=".lua,.txt" />
            </label>
            <label>
              Script Body (opsional)
              <textarea name="scriptBody"
                        rows="4"
                        placeholder="Paste Lua script di sini (jika diisi, akan diprioritaskan daripada file upload)"></textarea>
            </label>
          </div>
          <button class="btn-outline full" type="submit">Add Script</button>
        </form>
      </div>
    </section>

  </div>
</main>

<!-- JS: COPY BUTTONS + TITLE / LOGO TEXT CYCLES -->
<script>
  // Copy untuk userId, hwid, key, serverId, keyToken, dll (chip-copy)
  document.addEventListener('click', function (ev) {
    var btn = ev.target.closest('.chip-copy');
    if (!btn) return;
    var value = btn.getAttribute('data-copy');
    if (!value) return;

    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(value).then(function () {
        btn.classList.add('copied');
        btn.textContent = 'copied';
        setTimeout(function () {
          btn.classList.remove('copied');
          btn.textContent = 'copy';
        }, 1200);
      }).catch(function () {});
    }
  });

  // Title + header text cycles (ExHub - Admin Dashboard berubah-ubah)
  (function () {
    var titles = [
      'ExHub — Admin Dashboard',
      'ExHub — Live Monitor',
      'ExHub — Player & HWID Stats',
      'ExHub — Security Panel',
      'ExHub — Script Analytics'
    ];
    var logoTexts = titles.slice();
    var idx = 0;
    var logoEl = document.getElementById('logo-text');

    function applyTitle(i) {
      var t = titles[i] || titles[0];
      document.title = t;
      if (logoEl) {
        logoEl.classList.add('logo-text-fade');
        logoEl.textContent = logoTexts[i] || t;
        setTimeout(function () {
          if (logoEl) logoEl.classList.remove('logo-text-fade');
        }, 350);
      }
    }

    applyTitle(idx);

    setInterval(function () {
      idx = (idx + 1) % titles.length;
      applyTitle(idx);
    }, 6000);
  })();
</script>

<!-- Proteksi dasar: blokir klik kanan + beberapa shortcut DevTools -->
<script src="/js/protect-devtools.js"></script>

</body>
</html>
